<div class="min-h-screen bg-linear-to-br from-gray-100 to-amber-50 flex items-center justify-center p-4">
  <div class="w-full max-w-md bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
    <!-- Header -->
    <div class="bg-primary p-6 text-center relative">
      <div class="absolute inset-0 bg-linear-to-r from-transparent via-white/10 to-transparent"></div>
      <div class="relative z-10">
        <div class="mb-4">
          <img 
            src="assets/images/usco-logo.png" 
            alt="Universidad Surcolombiana"
            class="mx-auto h-16 w-auto filter brightness-0 invert drop-shadow-lg"
            onerror="this.style.display='none'"
          >
        </div>
        <h1 class="text-lg font-bold text-white mb-2">RECUPERAR CONTRASEÑA</h1>
        <p class="text-xs text-amber-200">Universidad Surcolombiana</p>
      </div>
    </div>
    
    <div class="p-6">
      <!-- Paso 1: Solicitar email -->
      <div *ngIf="step === 1">
        <div class="text-center mb-6">
          <i class="pi pi-envelope text-4xl text-primary mb-4"></i>
          <h2 class="text-xl font-bold text-gray-800 mb-2">¿Olvidaste tu contraseña?</h2>
          <p class="text-sm text-gray-600">
            Ingresa tu correo electrónico y te enviaremos un código para restablecer tu contraseña.
          </p>
        </div>

        <form [formGroup]="emailForm" (ngSubmit)="onSendCode()" class="space-y-6">
          <div class="field">
            <p-floatlabel>
              <input 
                id="email"
                type="email"
                pInputText
                formControlName="email"
                class="w-full"
                [class.ng-invalid]="emailControl?.invalid && emailControl?.touched"
              />
              <label for="email">
                <i class="pi pi-envelope mr-2 text-primary"></i>
                Correo electrónico
              </label>
            </p-floatlabel>
            <small 
              *ngIf="emailControl?.invalid && emailControl?.touched" 
              class="p-error block mt-2">
              <span *ngIf="emailControl?.hasError('required')">El correo electrónico es requerido</span>
              <span *ngIf="emailControl?.hasError('email')">Por favor ingresa un correo electrónico válido</span>
            </small>
          </div>

          <p-button
            type="submit"
            [disabled]="emailForm.invalid || isLoading"
            [loading]="isLoading"
            label="Enviar código"
            icon="pi pi-send"
            styleClass="w-full justify-center"
            class="w-full">
          </p-button>
        </form>
      </div>

      <!-- Paso 2: Ingresar código de verificación -->
      <div *ngIf="step === 2">
        <div class="text-center mb-6">
          <i class="pi pi-shield text-4xl text-primary mb-4"></i>
          <h2 class="text-xl font-bold text-gray-800 mb-2">Código de verificación</h2>
          <p class="text-sm text-gray-600">
            Hemos enviado un código de 6 dígitos a <strong>{{ maskedEmail }}</strong>
          </p>
        </div>

        <form [formGroup]="codeForm" (ngSubmit)="onVerifyCode()" class="space-y-6">
          <div class="field">
            <p-floatlabel>
              <input 
                id="code"
                type="text"
                pInputText
                formControlName="code"
                class="w-full text-center text-2xl tracking-widest"
                maxlength="6"
                placeholder="000000"
                [class.ng-invalid]="codeControl?.invalid && codeControl?.touched"
              />
              <label for="code">
                <i class="pi pi-key mr-2 text-primary"></i>
                Código de verificación
              </label>
            </p-floatlabel>
            <small 
              *ngIf="codeControl?.invalid && codeControl?.touched" 
              class="p-error block mt-2">
              <span *ngIf="codeControl?.hasError('required')">El código es requerido</span>
              <span *ngIf="codeControl?.hasError('pattern')">El código debe tener 6 dígitos</span>
            </small>
          </div>

          <p-button
            type="submit"
            [disabled]="codeForm.invalid || isLoading"
            [loading]="isLoading"
            label="Verificar código"
            icon="pi pi-check"
            styleClass="w-full justify-center"
            class="w-full">
          </p-button>

          <!-- Reenviar código -->
          <div class="text-center">
            <p class="text-sm text-gray-600 mb-2">¿No recibiste el código?</p>
            <button 
              type="button"
              *ngIf="!canResend"
              class="text-sm text-gray-400 cursor-not-allowed"
              disabled>
              Reenviar en {{ countdown }}s
            </button>
            <button 
              type="button"
              *ngIf="canResend"
              (click)="onResendCode()"
              [disabled]="isLoading"
              class="text-sm text-primary hover:text-primary-600 transition-colors font-medium">
              Reenviar código
            </button>
          </div>
        </form>
      </div>

      <!-- Paso 3: Nueva contraseña -->
      <div *ngIf="step === 3">
        <div class="text-center mb-6">
          <i class="pi pi-lock text-4xl text-primary mb-4"></i>
          <h2 class="text-xl font-bold text-gray-800 mb-2">Nueva contraseña</h2>
          <p class="text-sm text-gray-600">
            Ingresa tu nueva contraseña para tu cuenta.
          </p>
        </div>

        <form [formGroup]="passwordForm" (ngSubmit)="onResetPassword()" class="space-y-6">
          <div class="field">
            <p-floatlabel>
              <p-password 
                id="newPassword"
                formControlName="newPassword"
                styleClass="w-full"
                inputStyleClass="w-full"
                [toggleMask]="true"
                [feedback]="true"
                [class.ng-invalid]="newPasswordControl?.invalid && newPasswordControl?.touched">
              </p-password>
              <label for="newPassword">
                <i class="pi pi-lock mr-2 text-primary"></i>
                Nueva contraseña
              </label>
            </p-floatlabel>
            <small 
              *ngIf="newPasswordControl?.invalid && newPasswordControl?.touched" 
              class="p-error block mt-2">
              <span *ngIf="newPasswordControl?.hasError('required')">La contraseña es requerida</span>
              <span *ngIf="newPasswordControl?.hasError('minlength')">La contraseña debe tener al menos 8 caracteres</span>
            </small>
          </div>

          <div class="field">
            <p-floatlabel>
              <p-password 
                id="confirmPassword"
                formControlName="confirmPassword"
                styleClass="w-full"
                inputStyleClass="w-full"
                [toggleMask]="true"
                [feedback]="false"
                [class.ng-invalid]="confirmPasswordControl?.invalid && confirmPasswordControl?.touched">
              </p-password>
              <label for="confirmPassword">
                <i class="pi pi-lock mr-2 text-primary"></i>
                Confirmar contraseña
              </label>
            </p-floatlabel>
            <small 
              *ngIf="confirmPasswordControl?.invalid && confirmPasswordControl?.touched" 
              class="p-error block mt-2">
              <span *ngIf="confirmPasswordControl?.hasError('required')">Confirma tu contraseña</span>
              <span *ngIf="passwordForm.hasError('passwordMismatch') && confirmPasswordControl?.touched">Las contraseñas no coinciden</span>
            </small>
          </div>

          <p-button
            type="submit"
            [disabled]="passwordForm.invalid || isLoading"
            [loading]="isLoading"
            label="Cambiar contraseña"
            icon="pi pi-check"
            styleClass="w-full justify-center"
            class="w-full">
          </p-button>
        </form>
      </div>

      <!-- Paso 4: Éxito -->
      <div *ngIf="step === 4">
        <div class="text-center">
          <i class="pi pi-check-circle text-6xl text-green-500 mb-6"></i>
          <h2 class="text-xl font-bold text-gray-800 mb-4">¡Contraseña restablecida!</h2>
          <p class="text-sm text-gray-600 mb-6">
            Tu contraseña ha sido cambiada exitosamente. Ya puedes iniciar sesión con tu nueva contraseña.
          </p>
          
          <p-button
            (click)="goToLogin()"
            label="Ir al inicio de sesión"
            icon="pi pi-sign-in"
            styleClass="w-full justify-center"
            class="w-full">
          </p-button>
        </div>
      </div>

      <!-- Error Message -->
      <p-message 
        *ngIf="errorMessage" 
        severity="error" 
        [text]="errorMessage"
        class="mt-4">
      </p-message>

      <!-- Success Message -->
      <p-message 
        *ngIf="successMessage" 
        severity="success" 
        [text]="successMessage"
        class="mt-4">
      </p-message>

      <!-- Volver al login -->
      <div class="mt-8 text-center" *ngIf="step < 4">
        <a routerLink="/login" class="text-sm text-primary hover:text-primary-600 transition-colors">
          <i class="pi pi-arrow-left mr-1"></i>
          Volver al inicio de sesión
        </a>
      </div>
    </div>
  </div>
</div>